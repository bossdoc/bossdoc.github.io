

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Vessel Copilot &mdash; BOSS  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Route Planner" href="route_planner.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> BOSS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ui_standard.html">UI Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_docs.html">Writing Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytest.html">PyTest</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulator.html">Voyage Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="mirror.html">Mirror Offline HTML Form</a></li>
<li class="toctree-l1"><a class="reference internal" href="mirror.html#mirror-backend">Mirror Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="post_voyage.html">Post Voyage</a></li>
<li class="toctree-l1"><a class="reference internal" href="captn.html">Capt-N</a></li>
<li class="toctree-l1"><a class="reference internal" href="iva.html">IVA</a></li>
<li class="toctree-l1"><a class="reference internal" href="geo_helper.html">Geo Helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="spire_position.html">Spire Position</a></li>
<li class="toctree-l1"><a class="reference internal" href="weather_viz_v2.html">Weather Viz V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="ship_modelling.html">Ship Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="digital_ocean.html">Digital Ocean Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="sql_configuration.html">SQL Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging_configuration.html">Logging Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_module.html">Performance Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="route_planner.html">Route Planner</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vessel Copilot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main-files">Main Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-new-action">Writing a new action</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BOSS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Vessel Copilot</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/copilot.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vessel-copilot">
<span id="copilot"></span><h1>Vessel Copilot<a class="headerlink" href="#vessel-copilot" title="Permalink to this headline">¶</a></h1>
<div class="section" id="main-files">
<h2>Main Files<a class="headerlink" href="#main-files" title="Permalink to this headline">¶</a></h2>
<p>The main code files can be found in <code class="docutils literal notranslate"><span class="pre">apps/vessel_copilot</span></code>. Entry point for the backend should be <code class="docutils literal notranslate"><span class="pre">copilot.py</span></code>.
You can test it using <code class="docutils literal notranslate"><span class="pre">tests/tests_copilot.py</span></code> by running <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">vast/tests/tests_copilot</span> <span class="pre">-s</span></code>.</p>
<p>Views are defined in <code class="docutils literal notranslate"><span class="pre">apps/vessel_copilot/views_copilot.py</span></code>.
Templates are in <code class="docutils literal notranslate"><span class="pre">templates/vessel_copilot</span></code>.
Urls in <code class="docutils literal notranslate"><span class="pre">urls_vessel_copilot.py</span></code></p>
</div>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<p>Architecturally, we create instance of <code class="docutils literal notranslate"><span class="pre">VesselCopilot</span></code> (in <code class="docutils literal notranslate"><span class="pre">copilot.py</span></code>) for a particular ship.
This instantiates several bots that are tasked with analysing different aspects of the vessel - specs, dsr, mirror etc.
Each bot has an analyze function that returns a list of actions (instances of <code class="docutils literal notranslate"><span class="pre">action_template.CopilotAction</span> <span class="pre">class</span></code>).
These actions have an action_model attribute which is an object of <code class="docutils literal notranslate"><span class="pre">models.copilot_actions</span></code>.
The analyze function does not make any changes to the database.
We’ll call VesselCopilot.save_actions to save the actions in the database.</p>
<p>The table <code class="docutils literal notranslate"><span class="pre">models.copilot_actions</span></code> stores one action_name per ship (Does not store the whole history).
So if we have 500 ships and say a total of 50 action_names, we can have max 500X50 entries in this table.
Anytime anayze function is called, it checks the last saved action for this action_name and ship.
If a saved action is found, the saved action is updated and returned in the list of actions.
The table <code class="docutils literal notranslate"><span class="pre">models.copilot_emails</span></code> maintains a history of email communication about the given action.
This can be used in certain analysis functions and is also displayed on the UI.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The analyze function (and subfunctions) always returns an action of the given action_type
(unless the action never existed in the db and the problem is still not present).
If the action is already present in the database and the problem is now resolved (not present),
the analyze function returns the saved action with status marked as resolved and not an empty list.
We ensure this by always creating an action, regardless of whether the problem exists or not
with an empty problem description. Then if the problem is present, we update the problem description.
Finally we call <code class="docutils literal notranslate"><span class="pre">action_template.get_action_basis_saved_action</span></code> which handles whether to
update and return the saved action, create a new action or return None if an action does not exist
in DB and is no longer needed.</p>
</div>
</div>
<div class="section" id="writing-a-new-action">
<h2>Writing a new action<a class="headerlink" href="#writing-a-new-action" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Write a new <code class="docutils literal notranslate"><span class="pre">_analyze_xyz</span></code> function in the respective bot. Add the function in the list in the <code class="docutils literal notranslate"><span class="pre">analyze</span></code> function of the bot.</li>
<li>Each function MUST always create actions of the required action_names (even if the problem does not exist).</li>
<li>If the problem does not exist problem_description will be = “”. If it exists, problem description will be a non-empty sring.</li>
<li>Finally, we call <code class="docutils literal notranslate"><span class="pre">action_template.get_action_basis_saved_action</span></code> to update the saved action. This function marks the status of the saved action.</li>
<li>The status is marked as resolved if the problem does not exist, or it checks if email has been sent etc.</li>
<li>Set <code class="docutils literal notranslate"><span class="pre">ignore_description=True</span></code> if you want to update the saved action regardless of whether the description of new and old action is the same or not.</li>
</ul>
<p>Example code</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_analyze_missing_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">action_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">action_name</span> <span class="o">=</span> <span class="s2">&quot;missing_attributes&quot;</span>
    <span class="n">action_model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">copilot_actions</span><span class="p">()</span>
    <span class="n">action_model</span><span class="o">.</span><span class="n">ship</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ship</span>
    <span class="n">action_model</span><span class="o">.</span><span class="n">action_name</span> <span class="o">=</span> <span class="n">action_name</span>
    <span class="n">action_model</span><span class="o">.</span><span class="n">action_category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span>
    <span class="n">action_model</span><span class="o">.</span><span class="n">problem_title</span> <span class="o">=</span> <span class="s2">&quot;Missing vessel attributes&quot;</span>
    <span class="n">action_model</span><span class="o">.</span><span class="n">problem_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">action_model</span><span class="o">.</span><span class="n">proposed_solution</span> <span class="o">=</span> <span class="s2">&quot;Fetch the missing attributes from API from the vessel entry page&quot;</span>
    <span class="n">action_model</span><span class="o">.</span><span class="n">action_priority</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">action_model</span><span class="o">.</span><span class="n">redirect_urls</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span> <span class="p">(</span><span class="s2">&quot;Ship Modeling Fitter&quot;</span><span class="p">,</span> <span class="s2">&quot;/vw/ship_modelling_fitter/&quot;</span><span class="p">)</span> <span class="p">])</span>
    <span class="n">missing_attributes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_null_attributes</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ship</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ship</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">missing_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_attributes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">action_model</span><span class="o">.</span><span class="n">problem_description</span> <span class="o">=</span> <span class="s2">&quot;Missing attributes: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_attributes</span><span class="p">))</span>

    <span class="n">action_model</span> <span class="o">=</span> <span class="n">action_template</span><span class="o">.</span><span class="n">get_action_basis_saved_action</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ship</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span>
        <span class="n">action_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_actions</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_wait_days</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">action_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">action_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">action_template</span><span class="o">.</span><span class="n">CopilotAction</span><span class="p">(</span><span class="n">action_model</span><span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">action_list</span>
</pre></div>
</div>
<span class="target" id="module-vast.apps.vessel_copilot.copilot"></span><dl class="class">
<dt id="vast.apps.vessel_copilot.copilot.VesselCopilot">
<em class="property">class </em><code class="descclassname">vast.apps.vessel_copilot.copilot.</code><code class="descname">VesselCopilot</code><span class="sig-paren">(</span><em>ship</em>, <em>analyze_mode=True</em><span class="sig-paren">)</span><a class="headerlink" href="#vast.apps.vessel_copilot.copilot.VesselCopilot" title="Permalink to this definition">¶</a></dt>
<dd><p>Vessel copilot class
Instantiate this class to analyze a ship and get all the actions that need to be solved.</p>
<p>Doc page:</p>
<dl class="method">
<dt id="vast.apps.vessel_copilot.copilot.VesselCopilot.analyze">
<code class="descname">analyze</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vast.apps.vessel_copilot.copilot.VesselCopilot.analyze" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a list of actions</p>
</dd></dl>

<dl class="method">
<dt id="vast.apps.vessel_copilot.copilot.VesselCopilot.auto_solve_action">
<code class="descname">auto_solve_action</code><span class="sig-paren">(</span><em>action_id</em>, <em>function_and_args</em><span class="sig-paren">)</span><a class="headerlink" href="#vast.apps.vessel_copilot.copilot.VesselCopilot.auto_solve_action" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>function_and_args <span class="classifier-delimiter">:</span> <span class="classifier">dict</span></dt>
<dd><dl class="first docutils">
<dt>{</dt>
<dd>“function”: function,
“args”: args (dict)</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<span class="target" id="module-vast.apps.vessel_copilot.action_template"></span><dl class="function">
<dt id="vast.apps.vessel_copilot.action_template.get_action_basis_saved_action">
<code class="descclassname">vast.apps.vessel_copilot.action_template.</code><code class="descname">get_action_basis_saved_action</code><span class="sig-paren">(</span><em>ship</em>, <em>action_name</em>, <em>new_action_model</em>, <em>saved_actions</em>, <em>response_wait_days</em>, <em>ignore_description=False</em><span class="sig-paren">)</span><a class="headerlink" href="#vast.apps.vessel_copilot.action_template.get_action_basis_saved_action" title="Permalink to this definition">¶</a></dt>
<dd><p>This function looks at the saved action of the same action name and compares it with the new action model.
If the problem no longer exists, it will change status of saved action to resolved (db is not updated though)
If the problem still exists, it will check the status of the saved action.. Follow the code for the rest :P</p>
<p>Returns an instance of models.copilot_actions or None</p>
</dd></dl>

<span class="target" id="module-vast.apps.vessel_copilot.auto_solver"></span><dl class="function">
<dt id="vast.apps.vessel_copilot.auto_solver.send_email">
<code class="descclassname">vast.apps.vessel_copilot.auto_solver.</code><code class="descname">send_email</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#vast.apps.vessel_copilot.auto_solver.send_email" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>args = {</dt>
<dd>‘action_id’ : ,</dd>
</dl>
<p>}</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="route_planner.html" class="btn btn-neutral float-left" title="Route Planner" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Blue Water Trade Winds pvt ltd

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>